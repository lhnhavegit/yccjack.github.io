<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>SeaweedFS | MysticalYcc</title>
  <meta name="author" content="俞超超">

  
  <meta name="description" content="SeaweedFS[TOC]
SeaweedFS简介SeaweedFS是基于go语言开发的高可用文件存储系统，主要特征


存储上亿的文件(最终受限制于硬盘大小)
速度快，内存占用小




上手使用比fastDFS要简单很多，自带Rest API。
SeaWeeDFS作为对象存储库来有效地处理小文">
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="SeaweedFS">
  <meta property="og:site_name" content="MysticalYcc">

  
  

  
    <meta property="og:image" content>
  

  
  <link href="/css/images/favicon.ico" rel="icon">
  

  <link rel="alternate" href="/atom.xml" title="MysticalYcc" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  


  <!-- baidu webmaster push -->
  <script src="//push.zhanzhang.baidu.com/push.js"></script>

</head>
</html>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">MysticalYcc</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2019-08-19T10:00:13.019Z"><a href="/2019/08/19/SeaweedFS/">2019-08-19</a></time>
      
      
  
    <h1 class="title">SeaweedFS</h1>
  

    </header>
    <div class="entry">
      
        <h1 id="SeaweedFS"><a href="#SeaweedFS" class="headerlink" title="SeaweedFS"></a>SeaweedFS</h1><p>[TOC]</p>
<h2 id="SeaweedFS简介"><a href="#SeaweedFS简介" class="headerlink" title="SeaweedFS简介"></a>SeaweedFS简介</h2><p>SeaweedFS是基于go语言开发的高可用文件存储系统，主要特征</p>
<blockquote>
<ul>
<li>存储上亿的文件(最终受限制于硬盘大小)</li>
<li>速度快，内存占用小</li>
</ul>
</blockquote>
<br>

<p>上手使用比fastDFS要简单很多，自带Rest API。</p>
<p>SeaWeeDFS作为对象存储库来有效地处理小文件。不是管理中央主机中的所有文件元数据，中央主机只管理文件卷，它允许这些卷服务器管理文件和它们的元数据。<br>这减轻了来自中央主机的并发压力，并将文件元数据扩展到卷服务器，允许更快的文件访问（仅一个磁盘读取操作）。</p>
<br>

<p>每个文件的元数据只有40字节的磁盘存储开销。</p>
<br>

<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>seaweedfs是一个非常优秀的由 golang 开发的分布式存储开源项目。它是用来存储文件的系统，并且与使用的语言无关，使得文件储存在云端变得非常方便。</p>
<p>在逻辑上Seaweedfs的几个概念：</p>
<blockquote>
<ul>
<li><p>Node 系统抽象的节点，抽象为DataCenter、Rack、DataNode</p>
</li>
<li><p>DataCenter 数据中心，对应现实中的不同机房</p>
</li>
<li><p>Rack 机架，对应现实中的机柜</p>
</li>
<li><p>Datanode 存储节点，用于管理、存储逻辑卷</p>
</li>
<li><p>Volume 逻辑卷，存储的逻辑结构，逻辑卷下存储Needle</p>
</li>
<li><p>Needle 逻辑卷中的Object，对应存储的文件</p>
</li>
<li><p>Collection 文件集，可以分布在多个逻辑卷上</p>
</li>
</ul>
</blockquote>
<h2 id="搭建服务"><a href="#搭建服务" class="headerlink" title="搭建服务"></a>搭建服务</h2><h3 id="安装go环境"><a href="#安装go环境" class="headerlink" title="安装go环境"></a>安装go环境</h3><blockquote>
<ul>
<li>查看系统位数 getconf LONG_BIT</li>
<li>下载源码包</li>
<li>选择对应版本</li>
</ul>
</blockquote>
<pre><code>cd /usr/local
# 下载
wget https://golangtc.com/static/go/1.9.2/go1.9.2.linux-amd64.tar.gz
# 将其传到其他两台机器
# 解压
tar -zxf go1.9.2.linux-amd64.tar.gz
# 配置
vim /etc/profile
#加入
export GOPATH=/opt/go
export GOROOT=/usr/local/go
export GOOS=linux
export GOBIN=$GOROOT/bin
export GOTOOLS=$GOROOT/pkg/tool/
export PATH=$PATH:$GOBIN:$GOTOOLS

# 使配置文件生效
source /etc/profile

# 查看
go version</code></pre><h3 id="安装seaweedfs"><a href="#安装seaweedfs" class="headerlink" title="安装seaweedfs"></a>安装seaweedfs</h3><p>(1)下载 <a href="https://github.com/chrislusf/seaweedfs/releases/选择对应的版本" target="_blank" rel="noopener">https://github.com/chrislusf/seaweedfs/releases/选择对应的版本</a><br>(2)解压 tar -zxf linux_amd64.tar.gz<br>(3)./weed -h 查看帮助创建运行需要的目录   </p>
<pre><code class="xml">/../data            
 /../ vol/vol[1-3]    
 /../logs</code></pre>
<p>(4)配置运行master(如单机删除defaultReplication)</p>
<pre><code class="xml">./weed master -mdir=/../data -port=9333 -defaultReplication=&quot;001&quot; -ip=&quot;172.16.20.71&quot; &amp;&gt;&gt; /../logs/master.log &amp;
</code></pre>
<p>(5) 配置运行volume</p>
<p>具体参数查看帮助<br>/usr/local/weed volume -h</p>
<pre><code class="xml">./weed volume -port=9331 -dir=vol/vol1/ -max=100 -mserver=&quot;192.168.6.224:9333&quot; -ip=&quot;192.168.6.224&quot; &amp;&gt;vol/vol1/vol1.log &amp;</code></pre>
<h2 id="Java操作SeaweedFS"><a href="#Java操作SeaweedFS" class="headerlink" title="Java操作SeaweedFS"></a>Java操作SeaweedFS</h2><p>首先导入pom依赖</p>
<pre><code class="xml">     &lt;dependency&gt;
            &lt;groupId&gt;net.anumbrella.seaweedfs&lt;/groupId&gt;
            &lt;artifactId&gt;seaweedfs-java-client&lt;/artifactId&gt;
            &lt;version&gt;0.0.2.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
<p>编写SeaweedFS配置类SeaweedFSConfig</p>
<pre><code class="java">@Configuration
public class SeaweedFSConfig {

    @Value(&quot;${seaweedfs.host}&quot;)
    private String host;
    @Value(&quot;${seaweedfs.port}&quot;)
    private int port;

    @Bean
    public FileTemplate fileTemplate() {
        FileSource fileSource = new FileSource();
        // SeaweedFS master服务ip地址
        fileSource.setHost(host);
        // SeaweedFS master服务端口
        fileSource.setPort(port);
        try {
            // 启动服务
            fileSource.startup();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return new FileTemplate(fileSource.getConnection());
    }
}</code></pre>
<p>我的application.properties配置文件如下:</p>
<pre><code class="xml">seaweedfs.host=192.168.6.224 #多个ip地址用逗号隔开
seaweedfs.port=9333</code></pre>
<p>上传文件的方法如下,用的是Spring的JUnit测试:</p>
<pre><code class="java">@Autowired
private FileTemplate template;

@Test
public void testSeaweedFS() throws IOException {
        // 上传可以指定文件名
        FileHandleStatus handleStatus = template.saveFileByStream(&quot;file.type&quot;, new FileInputStream(new File(&quot;filePath&quot;)));
        // 获取文件ID,可通过这个ID获取到文件
        String fileId = handleStatus.getFileId();
        StreamResponse fileStream = template.getFileStream(fileId);
        InputStream inputStream = fileStream.getInputStream();
        // 获取流之后流拷贝输出到本地
        IOUtils.copy(inputStream,new FileOutputStream(new File(&quot;outPath&quot;)));
    }</code></pre>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/文件系统/">文件系统</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/SeaweedFS/">SeaweedFS</a>, <a href="/tags/分布式文件系统/">分布式文件系统</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/Spring-Cloud/">Spring Cloud</a><small>1</small></li>
  
    <li><a href="/categories/java/">java</a><small>2</small></li>
  
    <li><a href="/categories/sonarQube/">sonarQube</a><small>1</small></li>
  
    <li><a href="/categories/文件系统/">文件系统</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2019/08/19/Spring Cloud学习/">Spring Cloud</a>
      </li>
    
      <li>
        <a href="/2019/08/19/sonarqubSonar/">sonarQube</a>
      </li>
    
      <li>
        <a href="/2019/08/19/SeaweedFS/">SeaweedFS</a>
      </li>
    
      <li>
        <a href="/2019/08/19/powermock/">Mockito和PowerMock用法</a>
      </li>
    
      <li>
        <a href="/2019/08/19/深入浅析内存/">深入浅析内存</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/SeaweedFS/">SeaweedFS</a><small>1</small></li>
  
    <li><a href="/tags/Spring-Cloud/">Spring Cloud</a><small>1</small></li>
  
    <li><a href="/tags/java/">java</a><small>3</small></li>
  
    <li><a href="/tags/sonarQube/">sonarQube</a><small>1</small></li>
  
    <li><a href="/tags/内存/">内存</a><small>1</small></li>
  
    <li><a href="/tags/分布式文件系统/">分布式文件系统</a><small>1</small></li>
  
    <li><a href="/tags/单元测试/">单元测试</a><small>1</small></li>
  
    <li><a href="/tags/微服务/">微服务</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">Tag Cloud</h3>
  <div class="entry">
    <a href="/tags/SeaweedFS/" style="font-size: 10px;">SeaweedFS</a> <a href="/tags/Spring-Cloud/" style="font-size: 10px;">Spring Cloud</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/sonarQube/" style="font-size: 10px;">sonarQube</a> <a href="/tags/内存/" style="font-size: 10px;">内存</a> <a href="/tags/分布式文件系统/" style="font-size: 10px;">分布式文件系统</a> <a href="/tags/单元测试/" style="font-size: 10px;">单元测试</a> <a href="/tags/微服务/" style="font-size: 10px;">微服务</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  <p>
  
  &copy; 2019 俞超超
  
  All rights reserved.</p>
  <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</div>
<div class="clearfix"></div>

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id='bg'></div>
</body>
</html>